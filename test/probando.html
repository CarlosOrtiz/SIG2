<!DOCTYPE html>
<html>
<meta charset="utf-8" />

<head>
	<script src=" https://unpkg.com/leaflet@1.6.0/dist/leaflet.js "></script>
	<link rel="stylesheet" href=" https://unpkg.com/leaflet@1.6.0/dist/leaflet.css" />
	<script src="https://code.jquery.com/jquery-3.2.1.js"></script>
	<style>
		#map {
			width: 100%;
			height: 590px;
			box-shadow: 5px 5px 5px #888;
		}
	</style>
</head>

<body>
	<div id='map'>
	</div>
	<script>
		var osm = L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
			attribution: '&copy; <a href="http://osm.org/copyright">OpenStreetMap</a>'
				+ 'contributors',
			maxZoom: 18
		});


		var owsrootUrl = 'http://localhost:8080/geoserver/ows';

		var defaultParameters = {
			service: 'WFS',
			version: '1.3.0', //cambia version 
			request: 'GetFeature',
			typeName: 'earth:paisess',
			outputFormat: 'application/json'
		};

		var parameters = L.Util.extend(defaultParameters);

		var URL = owsrootUrl + L.Util.getParamString(parameters);


		var map = L.map('map', {
			center: [41.66, -4.72],
			zoom: 3,
			layers: osm
		});

		function style(feature) { return { fillColor: getColor(feature.properties.pop_est), weight: 2, opacity: 1, color: 'white', dashArray: '3', fillOpacity: 0.7 }; }

		function getColor(d) { return d > 100000000 ? '#800026' : d > 50000000 ? '#BD0026' : d > 20000000 ? '#E31A1C' : d > 10000000 ? '#FC4E2A' : d > 5000000 ? '#FD8D3C' : d > 2000000 ? '#FEB24C' : d > 1000000 ? '#FED976' : '#FFEDA0'; };


		/*
				$.ajax({
					url: URL,
					success: function (data) {
						//creamos una nueva capa geojson
						var geojson = new L.geoJson(data, {
							//Aplicamos un estilo
							//style: {"color":"#2ECCFA","weight":2},
							style: style,
							//vinculamos un popup mostrando el nombre del país
							onEachFeature: function (feature, layer) {
								layer.bindPopup("Has hecho click en " + feature.properties.name);
							}
						}
						).addTo(map);
					}
				});
		*/
		var paisesG = new L.geoJson(null, {
			//Aplicamos un estilo
			style: style,//{"color":"#2ECCFA","weight":2},
			//vinculamos un popup mostrando el nombre del país
			onEachFeature: function (feature, layer) {
				layer.bindPopup("Has hecho click en " + feature.properties.name);
			}
		});


		function loadGeojson(data) {
			paisesG.addData(data)
			map.addLayer(paisesG);
		}

		$.ajax({
			url: URL,
			dataType: 'json',
			success: loadGeojson
		});



		L.control.scale().addTo(map);
	</script>
</body>

</html>